---
title: "Cost coloring of bipartite graphs"
output:
  pdf_document:
    toc: yes
  html_notebook:
    theme: united
    toc: yes
  html_document:
    toc: yes
---

# Init
```{r cho = T, results = 'hide'}
library(igraph)
library(parallel)
library(tictoc)

source("src/3-pseudocoloring.R")
source("src/2-coloring.R")
source("src/is_colored_properly.R")
source("src/sum_coloring.R")
source("src/27_26-approximate-coloring.R")
source("src/brute_force.R")
source("src/is_optimal.R")
```
# Reference input
```{r}
c <- c(1,2,3,4)
g <- read.graph("graphs/bipartite.graphml", "graphml")

# setEPS()
# postscript("graphs/reference_graph.eps", fonts = c("serif"))
plot(g, layout=layout_as_bipartite, main='input graph', vertex.size=40, vertex.label.cex=1, vertex.label = paste(V(g)$name, '/', V(g)$weight))
# dev.off()
```
# Test 27/26-algorithm
```{r}
c <- c(1,2,3,4)
g <- read.graph("graphs/bipartite.graphml", "graphml")

tic("27/26-approximate algorithm")
result <- four_coloring(g, c)
toc()

S <- result[[1]]
Ssum <- result[[2]]

result_print(S, Ssum)
```
# Brute force
```{r}
c <- c(1,2,3,4)
g <- read.graph("graphs/bipartite.graphml", "graphml")

tic('Brute force alorithm')
B <- brute_force(g, c, Ssum)
toc()

Bsum <- sum_coloring(B, c)
if (Bsum < Ssum) {
  result_print(B, Bsum)
} else {
  result_print(S, Ssum)
}
```
# Bipartite
```{r}
for (i in 1:3) {
  graph <- sample_bipartite(4, 4, p=.6)
  plot(graph, layout = layout_as_bipartite)
}

```
# Test 0
```{r}
c <- c(1,2,3,4)
n = 11
g <- sample_bipartite(floor(n/2), ceiling(n/2), p=0.4)
V(g)$weight = sample(c(1,2,6,24), n, replace = TRUE)
V(g)$name <- letters[1:n]

# g <- read.graph("graphs/bipartite.graphml", "graphml")

tic("27/26-approximate")
result <- four_coloring(g, c)
toc()

S <- result[[1]]
Ssum <- result[[2]]
result_print(S, Ssum)

g$sumS <- Ssum

tic("brute_force")
B <- brute_force2(g, c, Ssum)
Bsum <- sum_coloring(B, c)
toc()

result_print(B, Bsum)

g$sumB <- Bsum
g$optimal <- Bsum == Ssum
write_graph(g, "graphs/test1/9_04.graphml", "graphml")

```
# graph generator
```{r}
n = 9
g <- sample_bipartite(floor(n/2), ceiling(n/2), p=0.8)
V(g)$weight = sample(c(1,2,6,24), n, replace = TRUE)
V(g)$name <- letters[1:n]
```

# Test 1 - different weight combinations
```{r}
tic('Generating graphs for test1')
weights <- c(1,2,6,24)
for (i in 1:length(weights)**length(V(g))) {
# for (i in 1:2) {
  gtmp <- g
  
  for (j in 1:length(V(gtmp))) {
    V(gtmp)[j]$weight <- 1
  }
  
  write_graph(gtmp, paste0('graphs/test1/', i, '.graphml'), "graphml")
}
toc()
```
# Write graph
```{r}
write_graph(g, "graphs/points_7_8_case.graphml", "graphml")
```
# Generate graphs to tests
```{r}
density <- c(0.2, 0.4, 0.6, 0.8, 1)
n <- 8

graphs <- lapply(density, function(x) {
  g <- sample_bipartite(floor(n/2), ceiling(n/2), p = x)
  V(g)$weight <- sample(1:10, n, replace = T)
  
  return (g)
})
graphs[[i]]

for (i in 1:length(graphs)) {
  # tic('Brute Force')
  # B <- brute_force(graphs[[i]], c)
  # Bsum <- color_sum(B, c)
  # toc()
  
  # tic('27/26 - approximate')
  # A <- four_coloring(graphs[[i]], c)
  # Asum <- color_sum(A, c)
  # toc()

  # print(paste('Approximation: ', Bsum / Asum))
}

```
# Number of combinations
```{r}
for (n in 1:20) {
  g3 <- make_full_bipartite_graph(floor(n/2), ceiling(n/2))
  
  proper <- 0
    
  for(j in k**n) {
    coloring <- sapply(as.list(rep(j, n)), function(x){
      i <- parent.frame()$i[]
      index <- 1 + (x / k ** (i-1)) %% k
      return(c[index])
    })
    
    V(g3)$color <- coloring
    
    if(colored_properly(graph)) {
      proper <- proper + 1
    }
    
  }
  
  print(n)
  print(k**n)
  print('next')
}
```
