---
title: "Cost coloring of bipartite graphs"
output:
  pdf_document:
    toc: yes
  html_notebook:
    theme: united
    toc: yes
  html_document:
    toc: yes
---

# Init
```{r cho = T, results = 'hide'}
library(igraph)
library(parallel)
library(tictoc)

source("src/3-pseudocoloring.R")
source("src/2-coloring.R")
source("src/is_colored_properly.R")
source("src/sum_coloring.R")
source("src/27_26-approximate-coloring.R")
source("src/brute_force.R")
```
# Reference input
```{r}
k <- 4
# c <- sort(sample(1:10, k, replace = FALSE))
c <- c(1,2,3,4)

g <- read.graph("graphs/p0_6.graphml", "graphml")
# g <- delete_vertex_attr(g, "color")

# n = 8
# g <- sample_bipartite(floor(n/2), ceiling(n/2), p=0.6)
# V(g)$weight = sample(c(1,2,6,24), n, replace = TRUE)

V(g)$name <- letters[1:n]

plot(g, layout=layout_as_bipartite, main='input graph', vertex.size=40, vertex.label.cex=1, vertex.label = paste(V(g)$name, '/', V(g)$weight))
```
# Test 27/26-algorithm
```{r}
tic("27/26-approximate algorithm")
S <- four_coloring(g, c)
toc()

Ssum <- sum_coloring(S, c)
V(S)$color
plot(S, layout=layout_as_bipartite, palette=diverging_pal(4), vertex.size=40, vertex.label.cex=1, main=paste('27/26-approximate - cost: ', Ssum), vertex.label = paste(V(S)$name, '/', V(S)$weight, '/', V(S)$color, sep=''))
```
# Brute force
```{r}
tic('Brute force alorithm')
B <- brute_force(g, c)
toc()

Bsum <- sum_coloring(B, c)
plot(B, layout=layout_as_bipartite, palette=diverging_pal(length(unique(V(B)$color))), vertex.size=40, vertex.label.cex=1, main=paste('Brute Force - sum:', Bsum), vertex.label = paste(V(B)$name, '/', V(B)$weight, '/', V(B)$color, sep=''))
```
# Write graph
```{r}
write_graph(g, "graphs/p0_6.graphml", "graphml")
```
# Generate graphs to tests
```{r}
density <- c(0.2, 0.4, 0.6, 0.8, 1)
n <- 8

graphs <- lapply(density, function(x) {
  g <- sample_bipartite(floor(n/2), ceiling(n/2), p = x)
  V(g)$weight <- sample(1:10, n, replace = T)
  
  return (g)
})
graphs[[i]]

for (i in 1:length(graphs)) {
  # tic('Brute Force')
  # B <- brute_force(graphs[[i]], c)
  # Bsum <- color_sum(B, c)
  # toc()
  
  # tic('27/26 - approximate')
  # A <- four_coloring(graphs[[i]], c)
  # Asum <- color_sum(A, c)
  # toc()

  # print(paste('Approximation: ', Bsum / Asum))
}

```
# Number of combinations
```{r}
for (n in 1:20) {
  g3 <- make_full_bipartite_graph(floor(n/2), ceiling(n/2))
  
  proper <- 0
    
  for(j in k**n) {
    coloring <- sapply(as.list(rep(j, n)), function(x){
      i <- parent.frame()$i[]
      index <- 1 + (x / k ** (i-1)) %% k
      return(c[index])
    })
    
    V(g3)$color <- coloring
    
    if(colored_properly(graph)) {
      proper <- proper + 1
    }
    
  }
  
  print(n)
  print(k**n)
  print('next')
}
```
